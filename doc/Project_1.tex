\documentclass[a4paper, 10pt, english]{revtex4-2} %Add reprint for two columns

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\usepackage{physics,amssymb}  % mathematical symbols (physics imports amsmath)
\usepackage{graphicx}         % include graphics such as plots
\usepackage{xcolor}           % set colors
\usepackage{hyperref}         % automagic cross-referencing (this is GODLIKE)
\usepackage{tikz}             % draw figures manually
%\usepackage{listings}         % display code
\usepackage{subfigure}        % imports a lot of cool and useful figure commands
\usepackage{array}
\usepackage{microtype}
\usepackage[export]{adjustbox}

\tolerance=1
\emergencystretch=\maxdimen
\hyphenpenalty=10000
\hbadness=10000

% defines the color of hyperref objects
% Blending two colors:  blue!80!black  =  80% blue and 20% black
\hypersetup{ % this is just my personal choice, feel free to change things
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}}

\newcommand{\txt}[1]{\text{#1}}
\newcommand{\parder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\dder}[2]{\frac{\partial^2 #1}{\partial #2^2}}

\begin{document}
\vspace*{1.5cm}
\title{\LARGE Computational physics: Project 1}
\author{Jon Aleksander Pr√∏itz}
\date{\today}
\noaffiliation
\maketitle

\section*{\large Describe the problem}
    \textbf{*ADD MOTIVATION}

    The goal of this project is to evaluate the ground state energy of a trapped, hard sphere Bose gas for different number of particles, using a specific trial wavefunction.

    We have used the Variational Monte Carlo method, starting with non-interacting particles in a spherical trap to check numerical data against analytical results.
    
    The trial wavefunction is used to study the sensitivity of condensate and non-condensate properties to the hard sphere radius and the number of particles.

    We start out with a simple Variational Monte Carlo method using the Metroplis algorithm.
    Then go on to add importance sampling.
    Using the gradient descent optimization to find the best variables.
    Analyze our results with the blocking and bootstrap techniques.
    Then move on to describe a repuslive two-body interaction.

\section*{\large algorithms}
    Starting out we use a Variational Monte Carlo method with the Metroplis algorithm with a spherical trap, only varying the $\alpha$ parameter of the trial wavefunction.
    We move a single particle in a single dimension at a time, with a probability of moving the particle equal the value of the trail wavefunction at the new position squared divided by the trial wavefunction at the old position squared.
    After all particles in all dimensions has gone through a single step in this algorithm the energy of the system is sampled and when all steps are completed the mean energy is calculated.
    The mean energy is then stored and the algorithm repeats with a new value of $\alpha$.

    The system is initialized with random positions in a uniform distribution between $-\frac{1}{2}s$ and $\frac{1}{2}s$ where $s$ is the step length used in the Metroplis algorithm and then run through $10^5$ equilibration steps using the above Metrpolis algorithm.


    Moving on we add importance sampling with a quantum force, based on the Fokker-Planck and the Langevin equations to the algorithm.
    This adds an "incentive" for the particles to move towards areas where the values of the trial wavefunction are higher.
    The change in position of the particles in a Metroplis step is altered to include the quantum force and a Greensfunction is added to the probability that a particle moves.

    Next up we add a gradient descent optimization to the algorithm.
    After each Metroplis step we calculate the gradient of the wavefunction and use this to find the derivative of the energy which is then used for updating the value of $\alpha$ closer to the minimum value.
    This ensures that the values of alpha always moves away from values far away from the minimum value, and will move faster away from those values wich are further away from the minimum.

    Making the program write out every $2^{10}$ step, we uitilize Marius Jonssons blocking algorithm to get the final energy with the following standard deviations.

    \textbf{NEXT UP PARALLELIZATION!}

    
\section*{\large Test versus analytical results}
    Problem B: We note that the energy matches the analytical result for $\alpha = 0.5$ and that the variance is 0.
    This is expected from the analytical expression, where $\alpha = 1/2a_{ho}^2$ with $a_{ho} = 1$ in natural units.
    
    Problem C: We note the same results as in problem b, we simply need fewer metropolis steps.

    Problem D: With the gradient descent algorithm we note that with a weight of $\eta = 0.01$ for one particle in one dimension we reach a alphavalue of $\alpha = 4.93966$ after 154 iterations. the change in alpha values at this point is below $0.0001$ and the algorithm stops.
    For two particles in two dimensions we reach $\alpha = 0.498934$ after 57 iterations, again with the change in $\alpha$ being less than $0.0001$.
    For three particles in three dimensions we reach $\alpha = 0.499258$ after 23 iterations.

    Problem E: Implementing the Blocking algorithm from Marius Jonssons program with the above values of alpha, run for $2^{19}$ metropolis steps we get standard deviations on the scale of $10^{-5}$ in all three cases.

\section*{\large Solutions: Problem A}
    The local energy is given by
    \begin{equation}
            E_L 
        =   \frac{1}{\Psi_T}H\Psi_T
    \end{equation}
    with
    \begin{equation}
            H
        =   \sum_i^N \left(\frac{-\hbar^2}{2m} \nabla_i^2 + V_\txt{ext}\right) + \sum_{i<j}^N V_\txt{int}
    \end{equation}
    \begin{equation}
            V_{ext}(\mathbf{r}) 
        =   \Bigg\{
        \begin{array}{ll}
            \frac{1}{2}m\omega_{ho}^2r^2 & (S)\\
        \strut
            \frac{1}{2}m[\omega_{ho}^2(x^2+y^2) + \omega_z^2z^2] & (E)
        \label{trap_eqn}
        \end{array}
    \end{equation}
    \begin{equation}
        V_{int}(|\mathbf{r}_i-\mathbf{r}_j|) =  \Bigg\{
        \begin{array}{ll}
            \infty & {|\mathbf{r}_i-\mathbf{r}_j|} \leq {a}\\
            0 & {|\mathbf{r}_i-\mathbf{r}_j|} > {a}
        \end{array}
    \end{equation}
    \begin{equation}
        \Psi_T(\mathbf{r})=\Psi_T(\mathbf{r}_1, \mathbf{r}_2, \dots \mathbf{r}_N,\alpha,\beta)
        =\left[
           \prod_i g(\alpha,\beta,\mathbf{r}_i)
        \right]
        \left[
           \prod_{j<k}f(a,|\mathbf{r}_j-\mathbf{r}_k|)
        \right],
        \label{eq:trialwf}
    \end{equation}
    with 
    \begin{equation}
            g(\alpha, \beta, \mathbf{r}_i)
        =   exp\left[-\alpha\left(x_i^2+y_i^2+\beta z_i^2\right)\right]
    \end{equation}
    \begin{equation}
            f(a,|\mathbf{r}_i-\mathbf{r}_j|)=\Bigg\{
        \begin{array}{ll}
            0 & {|\mathbf{r}_i-\mathbf{r}_j|} \leq {a}\\
            (1-\frac{a}{|\mathbf{r}_i-\mathbf{r}_j|}) & {|\mathbf{r}_i-\mathbf{r}_j|} > {a}.
        \end{array}
    \end{equation}
    for $a=0$, $\beta = 1$, note that in one dimension for one particle
    \begin{equation}
            \frac{1}{\Psi_T}\dder{\Psi_T}{x}
        =   -2\alpha\frac{1}{\Psi_T}\parder{\Psi_T}{x}\left(x\Psi_T\right)
        =   2\alpha{\left(2\alpha x^2 - 1\right)}
    \end{equation}
    Due to the symmetric properties of the trial wavefunction we note that with $\nabla^2 = \sum_{i=1}\dder{}{x_i}$
    \begin{equation}
            \frac{1}{\Psi_T} \sum_{i=1}^d \dder{\Psi_T}{x_i}
        =   2\alpha\left(2\alpha\sum_{i=1}^dx_i^2 - d\right)
        =   2\alpha\left(2\alpha r^2 - d\right)
    \end{equation}
    where $d$ is the number of dimensions. Hence
    \begin{equation}
            E_L
        =   \sum_i^N\left(\frac{-\hbar^2}{2m}2\alpha\left(2\alpha r_i^2 - d\right) + \frac{1}{2}m\omega_{ho}^2r_i^2\right)
        =   \sum_i^N\frac{d}{2}\hbar\omega_{ho}
        =   \frac{Nd}{2}\hbar\omega_{ho}
    \end{equation}
    with $\alpha = 1/2a_{ho}^2$ and $a_{ho} = \sqrt{\hbar/m\omega_{ho}}$
    \begin{equation}
            \mathbf{F}
        =   \frac{2\nabla \Psi_T}{\Psi_T}
        =   -4\alpha \sum_{i=1}^d x_i \hat{\mathbf{x}_i}
    \end{equation}

    Define $g(\alpha, \beta, \mathbf{r}_i) = \phi(\mathbf{r}_i)$ and $r_{jm} = |\mathbf{r}_j - \mathbf{r}_m|$, such that
    \begin{equation}
            \Psi_T 
        =   \left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} \ln{f(r_{jm})}}
        =   \left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})}
    \end{equation}
    with $u(r_{jm}) = \ln{f(r_{jm})}$. The derivative of particle $k$ is then
    \begin{equation}
            \nabla_k\Psi_T 
        =   \nabla_k\left[\prod_i \phi(\mathbf{r}_i)\right]e^{\sum_{j<m} u(_{jm})} + \left[\prod_i\phi(\mathbf{r}_i)\right] \nabla_k\left(e^{\sum_{j<m} u(r_{jm})}\right)
    \end{equation}
    we note that in the frist term only particle $k$ is affected by the derivation, such that
    \begin{equation}
            \nabla_k\prod_i \phi(\mathbf{r}_i) 
        =   \nabla_k\phi(\mathbf{r}_i)\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right]
    \end{equation}
    while the second term
    \begin{equation}
                \nabla_k\left(e^{\sum_{j<m} u(r_{jm})}\right)
            =   e^{\sum_{j<m} u(r_{jm})} \nabla_k\sum_{j<m}u(r_{jm})
            =   e^{\sum_{j<m} u(r_{jm})} \sum_{k\neq l}\nabla_k u(r_{kl})
    \end{equation}
    such that
    \begin{equation}
            \nabla_k\Psi_T 
        =   \nabla_k\phi(\mathbf{r}_i)\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} + \left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} \sum_{k\neq l}\nabla_k u(r_{kl})
    \end{equation}     




\end{document}
