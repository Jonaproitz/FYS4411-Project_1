\documentclass[a4paper, 10pt, english]{revtex4-2} %Add reprint for two columns

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\usepackage{physics,amssymb}  % mathematical symbols (physics imports amsmath)
\usepackage{graphicx}         % include graphics such as plots
\usepackage{xcolor}           % set colors
\usepackage{hyperref}         % automagic cross-referencing (this is GODLIKE)
\usepackage{tikz}             % draw figures manually
%\usepackage{listings}         % display code
\usepackage{subfigure}        % imports a lot of cool and useful figure commands
\usepackage{array}
\usepackage{microtype}
\usepackage[export]{adjustbox}

\tolerance=1
\emergencystretch=\maxdimen
\hyphenpenalty=10000
\hbadness=10000

% defines the color of hyperref objects
% Blending two colors:  blue!80!black  =  80% blue and 20% black
\hypersetup{ % this is just my personal choice, feel free to change things
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}}

\newcommand{\txt}[1]{\text{#1}}
\newcommand{\parder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\dder}[2]{\frac{\partial^2 #1}{\partial #2^2}}

\begin{document}
\vspace*{1.5cm}
\title{\LARGE Computational physics II: Project 1}
\author{Jon Aleksander Pr√∏itz}
\date{\today}
\noaffiliation
\maketitle

\section*{\large Introduction}
    Theoritical studies of Bose-Einstein condensates in gases consisting of alkili atoms confined in magnetic or optical traps are often based off of the Gross-Pitaevskii equation. 
    Note that validity of these studies are dependent on the condition that the system is dilute, or in other words that the average distance between atoms is much larger than the range of the inter-atomic interactions. 
    Thus interactions of the system is largely dominated by two-body collisons wich are well described by the s-wave scattering length $a$.
    When defining the diluteness of a gas an important aspect is the gas parameter $x(r) = n(r)a^3$, where $n(r)$ is the local density of the system, and for low values of the average gas parameter $x_{av} = 10^{-3}$ the mean field Gross-Pitaevskii equation works excidingly well.
    Yet it has bin shown experimentally that the local gas paramet can exceed this value by tuning the scattering length in the pressence of a Feshbach resonance.
    Thus improved many-body methods like Monte-Carlo calculations may be required.


    The goal of this project is to evaluate the ground state energy of a trapped, hard sphere Bose gas for different number of particles, using a specific trial wavefunction $\Psi_T$.
    We have used the Variational Monte Carlo method, starting with non-interacting particles in a spherical trap to check numerical data against analytical results.
    The trial wavefunction is used to study the sensitivity of condensate and non-condensate properties to the hard sphere radius and the number of particles.

    Our numerical studies start out with a simple Variational Monte Carlo method using the Metroplis algorithm to test the validity of our numerical data.
    We will then go on to add importance sampling based on the Fokker-Planck and Langevin equations, before adding a stochastic gradient descent algorithm to find optimal values of the trial wavefunction parameter $\alpha$.
    The result are then analyzed with the blocking technique.
    Finally we can then paralleize our program and start tackling the repulsive two-body problem.


\section*{\large Analytic expressions}
    We represent our system with a spherical (S), or elliptical (E) trap, given by
    \begin{equation}
            V_{ext}(\mathbf{r}) 
        =   \Bigg\{
        \begin{array}{ll}
            \frac{1}{2}m\omega_{ho}^2r^2 & (S)\\
        \strut
            \frac{1}{2}m[\omega_{ho}^2(x^2+y^2) + \omega_z^2z^2] & (E)
        \label{eq: trap_eqn}
        \end{array}
    \end{equation}
    in the spherical case $\omega_{ho}$ defines the trap potential, while for the elliptical case $\omega_{ho}$ defines the trap frequency in the $xy$-plane and $\omega_z$ is the trap frequency in the $z$-direction.
    The mean square vibrational amplitude of a single boson at $T=0K$ is $\langle x^2\rangle = \sqrt{\hbar/2m\omega_{ho}}$ such that the charecteristic length is $a_{ho} = \sqrt{\hbar/m\omega_{ho}}$.
    The two-body Hamiltonian of the system is
    \begin{equation}
            H
        =   \sum_i^N \left(\frac{-\hbar^2}{2m} \nabla_i^2 + V_\txt{ext}\right) + \sum_{i<j}^N V_\txt{int}
    \end{equation}
    with $N$ being the number of particles and the inter-boson interaction is represented by a pairwise repuslive potential
    \begin{equation}
        V_{int}(|\mathbf{r}_i-\mathbf{r}_j|) =  \Bigg\{
        \begin{array}{ll}
            \infty & {|\mathbf{r}_i-\mathbf{r}_j|} \leq {a}\\
            0 & {|\mathbf{r}_i-\mathbf{r}_j|} > {a}
        \end{array}
    \end{equation}
    where $a$ is the hard-core diameter of the bosons.
    The trial wavefunction for the ground state with $N$ atoms is given by
    \begin{equation}
        \Psi_T(\mathbf{r})=\Psi_T(\mathbf{r}_1, \mathbf{r}_2, \dots \mathbf{r}_N,\alpha,\beta)
        =\left[
        \prod_i g(\alpha,\beta,\mathbf{r}_i)
        \right]
        \left[
        \prod_{j<k}f(a,|\mathbf{r}_j-\mathbf{r}_k|)
        \right],
        \label{eq: trialwf}
    \end{equation}
    with 
    \begin{equation}
            g(\alpha, \beta, \mathbf{r}_i)
        =   exp\left[-\alpha\left(x_i^2+y_i^2+\beta z_i^2\right)\right]
    \end{equation}
    and
    \begin{equation}
            f(a,|\mathbf{r}_i-\mathbf{r}_j|)=\Bigg\{
        \begin{array}{ll}
            0 & {|\mathbf{r}_i-\mathbf{r}_j|} \leq {a}\\
            (1-\frac{a}{|\mathbf{r}_i-\mathbf{r}_j|}) & {|\mathbf{r}_i-\mathbf{r}_j|} > {a}.
        \end{array}
    \end{equation}
    \subsection*{Local energy}
        For non-interacting bosons we set $a=0$ in a spherical potential, $\beta=1$, the trial wavefunction can be written
        \begin{equation}
                \Psi_T(\mathbf{r})
            =   e^{-\alpha r^2}
            =   e^{-\alpha (x^2 + y^2 + z^2)}
        \end{equation}
        such that the double derivative in one dimension
        \begin{equation}
                E_L 
            =   \frac{1}{\Psi_T}H\Psi_T
            =   \frac{1}{\Psi_T}\dder{\Psi_T}{x}
            =   -2\alpha\frac{1}{\Psi_T}\parder{\Psi_T}{x}\left(x\Psi_T\right)
            =   2\alpha{\left(2\alpha x^2 - 1\right)}
        \end{equation}
        Denoting the vector $\mathbf{r} \equiv \mathbf{x} = (x_1, x_2, x_3)$, with $\nabla^2 = \sum_{i=1}\dder{}{x_i}$, we obtain the double derivative of a single boson in $d$ dimensions
        \begin{equation}
                \frac{1}{\Psi_T(\mathbf{x})} \sum_{i=1}^d \dder{\Psi_T(\mathbf{x})}{x_i}
            =   2\alpha\left(2\alpha\sum_{i=1}^dx_i^2 - d\right)
            =   2\alpha\left(2\alpha r^2 - d\right)
        \end{equation}
        Hence the local energy of the total system in $d$ dimensions with $N$ particles is given by
        \begin{equation}
                E_L
            =   \sum_i^N\left(\frac{-\hbar^2}{2m}2\alpha\left(2\alpha r_i^2 - d\right) + \frac{1}{2}m\omega_{ho}^2r_i^2\right)
            =   \sum_i^N\frac{d}{2}\hbar\omega_{ho}
            =   \frac{Nd}{2}\hbar\omega_{ho}
        \end{equation}
        using $\alpha = 1/2a_{ho}^2$ and $a_{ho} = \sqrt{\hbar/m\omega_{ho}}$ in the second calculation.
        We note that setting $\hbar=\omega_{ho}=m=1$ gives $\alpha=1/2$.

    \subsection*{Drift force}
        Again denoting $\mathbf{r} \equiv \mathbf{x} = (x_1, x_2, x_3)$, the drift force
        \begin{equation}
                \mathbf{F}
            =   \frac{2\nabla \Psi_T(\mathbf{x})}{\Psi_T(\mathbf{x})}
            =   \frac{2}{\Psi_T}\sum_{i=1}^d \hat{\mathbf{x}}_i\dder{}{x_i}e^{-\alpha x^2}
            =   -4\alpha \sum_{i=1}^d x_i \hat{\mathbf{x}_i}
        \end{equation}

    \subsection*{Two-body interaction}
        Define $g(\alpha, \beta, \mathbf{r}_i) = \phi(\mathbf{r}_i)$ and $r_{jm} = |\mathbf{r}_j - \mathbf{r}_m|$, such that
        \begin{equation}
                \Psi_T 
            =   \left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} \ln{f(r_{jm})}}
            =   \left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})}
        \end{equation}
        with $u(r_{jm}) = \ln{f(r_{jm})}$. The derivative of particle $k$ is then
        \begin{equation}
                \nabla_k\Psi_T 
            =   \nabla_k\left[\prod_i \phi(\mathbf{r}_i)\right]e^{\sum_{j<m} u(_{jm})} + \left[\prod_i\phi(\mathbf{r}_i)\right] \nabla_k\left(e^{\sum_{j<m} u(r_{jm})}\right)
        \end{equation}
        we note that in the frist term only particle $k$ is affected by the derivation, such that
        \begin{equation}
                \nabla_k\prod_i \phi(\mathbf{r}_i) 
            =   \nabla_k\phi(\mathbf{r}_i)\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right]
            \label{eq: derphi}
        \end{equation}
        while the second term
        \begin{equation}
                    \nabla_k\left(e^{\sum_{j<m} u(r_{jm})}\right)
                =   e^{\sum_{j<m} u(r_{jm})} \nabla_k\sum_{j<m}u(r_{jm})
                =   e^{\sum_{j<m} u(r_{jm})} \sum_{k\neq l}\nabla_k u(r_{kl})
                \label{eq: dere}
        \end{equation}
        such that
        \begin{equation}
                \nabla_k\Psi_T 
            =   \nabla_k\phi(\mathbf{r}_k)\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} + \left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} \sum_{k\neq l}\nabla_k u(r_{kl})
            \label{eq: first der}
        \end{equation}     

        To find the double derivative we start by derivating the first term of eq \ref*{eq: first der}
        \begin{equation}
                \nabla_k\left(\nabla_k\phi(\mathbf{r}_k)\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})}\right)
            =   \left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} \nabla_k^2\phi(\mathbf{r}_k) + \nabla_k\phi(\mathbf{r}_k)\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] \nabla_k e^{\sum_{j<m} u(r_{jm})}
            \label{eq: more derivations}
        \end{equation}
        the first term of eq \ref*{eq: more derivations} is then
        \begin{equation}
                \frac{\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})}}{\Psi_T} \nabla_k^2 \phi(\mathbf{r}_k)
            =   \frac{\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})}}{\phi(\mathbf{r}_k)\left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})}} \nabla_k^2 \phi(\mathbf{r}_k)
            =   \frac{1}{\phi(\mathbf{r}_k)} \nabla_k^2 \phi(\mathbf{r}_k)
        \end{equation}
        Using eq \ref*{eq: dere} we find that the second term of eq \ref*{eq: more derivations}
        \begin{equation}
                \frac{\nabla_k \phi(\mathbf{r}_k) \left[\prod_{i\neq k}\phi(\mathbf{r}_i)\right]}{\Psi_T} \nabla_k e^{\sum_{j<m} u(r_{jm})}
            =   \frac{\nabla_k \phi(\mathbf{r}_k)}{\phi(\mathbf{r}_k)} \sum_{k\neq l}\nabla_k u(r_{kl})
        \end{equation}
        moving on to the second term of eq \ref*{eq: first der}
        \begin{align}
        \begin{split}
                &\nabla_k\left(\left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} \sum_{k\neq l}\nabla_k u(r_{kl})\right)\\
            =   &e^{\sum_{j<m} u(r_{jm})} \sum_{k\neq l}\nabla_k u(r_{kl}) \nabla_k \left[\prod_i\phi(\mathbf{r}_i)\right] 
                + \left[\prod_i\phi(\mathbf{r}_i)\right] \sum_{k\neq l}\nabla_k u(r_{kl}) \nabla_k e^{\sum_{j<m} u(r_{jm})}\\
            &+  \left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} \nabla_k \sum_{k\neq l}\nabla_k u(r_{kl})
            \label{eq: second der}
        \end{split}
        \end{align}
        we find the first term of eq \ref*{eq: second der}
        \begin{equation}
                \frac{1}{\Psi_T} e^{\sum_{j<m} u(r_{jm})} \sum_{k\neq l}\nabla_k u(r_{kl}) \nabla_k \left[\prod_i\phi(\mathbf{r}_i)\right]
            =   \frac{\nabla_k \phi(\mathbf{r}_k)}{\phi(\mathbf{r}_k)} \sum_{k\neq l}\nabla_k u(r_{kl})
        \end{equation}
        then the second term
        \begin{equation}
                \frac{1}{\Psi_T}\left[\prod_i\phi(\mathbf{r}_i)\right] \sum_{k\neq l}\nabla_k u(r_{kl}) \nabla_k e^{\sum_{j<m} u(r_{jm})}
            =   \left(\sum_{k\neq l}\nabla_k u(r_{kl})\right) \left(\sum_{k\neq i}\nabla_k u(r_{ki})\right)
        \end{equation}
        and lastly the third term
        \begin{equation}
                \frac{1}{\Psi_T}\left[\prod_i\phi(\mathbf{r}_i)\right] e^{\sum_{j<m} u(r_{jm})} \nabla_k \sum_{k\neq l}\nabla_k u(r_{kl})
            =   \sum_{k\neq l} \nabla_k^2 u(r_{kl})
        \end{equation}

        Now with the realtions
        \begin{equation}
                \nabla_k u(r_{ki})
            =   \frac{\mathbf{r}_k - \mathbf{r}_i}{r_{ki}}u'(r_{ki})
        \end{equation}
        and
        \begin{equation}
                \nabla_k^2 u(r_{ki})
            =   u''(r_{ki}) + \frac{2}{r_{ki}}u'(r_{ki})
        \end{equation}
        we can find the second derivative
        \begin{equation}
                \frac{1}{\Psi_T} \nabla_k^2 \Psi_T
            =   \frac{\nabla_k^2 \phi(\mathbf{r}_k)}{\phi(\mathbf{r}_k)} 
                + 2\frac{\nabla_k \phi(\mathbf{r}_k)}{\phi(\mathbf{r}_k)} \sum_{k\neq l} \frac{\mathbf{r}_k - \mathbf{r}_l}{r_{kl}}u'(r_{kl})
                + \sum_{k\neq l}\sum_{k\neq i} \frac{(\mathbf{r}_k - \mathbf{r}_l)(\mathbf{r}_k - \mathbf{r}_i)}{r_{kl}r_{ki}}u'(r_{kl})u'(r_{ki})
                + \sum_{l \neq k} u''(r_{ki}) + \frac{2}{r_{ki}}u'(r_{ki})
        \end{equation}

\section*{\large algorithms}
    Starting out we use a Variational Monte Carlo method with the Metroplis algorithm with a spherical trap, only varying the $\alpha$ parameter of the trial wavefunction.
    We move a single particle in a single dimension at a time, with a probability of moving the particle equal the value of the trail wavefunction at the new position squared divided by the trial wavefunction at the old position squared.
    After all particles in all dimensions has gone through a single step in this algorithm the energy of the system is sampled and when all steps are completed the mean energy is calculated.
    The mean energy is then stored and the algorithm can repeat with a new value of $\alpha$.

    The system is initialized with random positions in a uniform distribution between $-\frac{1}{2}s$ and $\frac{1}{2}s$ where $s$ is the step length used in the Metroplis algorithm and then run through $10^5$ equilibration steps using the above Metrpolis algorithm.


    Moving on we add importance sampling with a quantum force, based on the Fokker-Planck and the Langevin equations to the algorithm.
    This adds an "incentive" for the particles to move towards areas where the values of the trial wavefunction are higher.
    The change in position of the particles in a Metroplis step is altered to include the quantum force and a Greensfunction is added to the probability that a particle moves.

    Next up we add a gradient descent optimization to the algorithm.
    After each Metroplis step we calculate the gradient of the wavefunction and use this to find the derivative of the energy which is then used for updating the value of $\alpha$ closer to the minimum value.
    This ensures that the values of alpha always moves away from values far away from the minimum value, and will move faster away from those values wich are further away from the minimum.

    Making the program write out every $2^{10}$ step, we uitilize Marius Jonssons blocking algorithm to get the final energy with the following standard deviations.

    \textbf{NEXT UP PARALLELIZATION!}

    
\section*{\large Test versus analytical results}
    Problem B: We note that the energy matches the analytical result for $\alpha = 0.5$ and that the variance is 0.
    This is expected from the analytical expression, where $\alpha = 1/2a_{ho}^2$ with $a_{ho} = 1$ in natural units.
    
    Problem C: We note the same results as in problem b, we simply need fewer metropolis steps.

    Problem D: With the gradient descent algorithm we note that with a weight of $\eta = 0.01$ for one particle in one dimension we reach a alphavalue of $\alpha = 4.93966$ after 154 iterations. the change in alpha values at this point is below $0.0001$ and the algorithm stops.
    For two particles in two dimensions we reach $\alpha = 0.498934$ after 57 iterations, again with the change in $\alpha$ being less than $0.0001$.
    For three particles in three dimensions we reach $\alpha = 0.499258$ after 23 iterations.

    Problem E: Implementing the Blocking algorithm from Marius Jonssons program with the above values of alpha, run for $2^{19}$ metropolis steps we get standard deviations on the scale of $10^{-5}$ in all three cases.




\end{document}
